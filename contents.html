<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
    <title>PI Chart Maker</title>
    <style>
        body{
            margin: 0;
            background-color: lightgoldenrodyellow;
        }
        canvas{
            background-color:rgb(252, 246, 251);
            border:1px solid black;
        }
        td,tr{
            border:1px solid black;
            padding: 5px;
        }
        table{
            border: 1px solid black;
            border-collapse: collapse;
            background-color: greenyellow;
        }
        .dynamicInput{
            width: 100px;
        }
    </style>
</head>
<body>
    <center>
       
        <h1>PI Chart Maker</h1>
        <br>
        <canvas id="canvas"></canvas>
        <br>
        <h3>Enter Data</h3>
        <button id="addButton">Add</button>
        <button id="delButton">Remove</button>
        <button id="plot" onclick="plot()">Plot</button>
        <br>
        <button id="download" onclick="download()">Download Chart</button>
       <br>
        <input id="charttile"  placeholder="Enter Chart Title">
        <br><br>
        <table id="table">
            <tr><td>Section Name</td><td>Value</td></tr>
           
        </table>
        <br>
        <br>
    </center>
</body>
<script>
    var canvas=document.getElementById('canvas');
    var ctx=canvas.getContext('2d');
    var w=350;
    var h=300;
    canvas.width=w;
    canvas.height=h;

    

    var table=document.getElementById('table');
    var button=document.getElementById('addButton');
    var delButton=document.getElementById('delButton');

   

    button.addEventListener('click',function(){
        //table.innerHTML="";
                var td1=document.createElement('td');
                var tr=document.createElement('tr');
            
            td1.innerHTML="<input class='dynamicInput'>";
            tr.appendChild(td1);
            var td2=document.createElement('td');
            td2.innerHTML="<input class='dynamicInput' type='number'>";
            tr.appendChild(td2);
            table.appendChild(tr);
    });
    
    delButton.addEventListener('click',function()
    {
        if(table.childNodes.length>3)
        table.removeChild(table.childNodes[table.childNodes.length-1]);
    });
    
    var data=[];
    function getColorCode() {
      var makeColorCode = '0123456789ABCDEF';
      var code = '#';
      for (var count = 0; count < 6; count++) {
         code =code+ makeColorCode[Math.floor(Math.random() * 16)];
      }
      return code;
    }

    var charttile=document.getElementById("charttile");
    
    
    function plot()
    {       
       
           
            
            data=[];
            ctx.clearRect(0,0,w,h);
            ctx.fillStyle="rgb(252, 246, 251)";    
            ctx.fillRect(0,0,w,h);
                   
           
         
            
            for(var i=2;i<table.childNodes.length;++i)
            {
                var nm=table.childNodes[i].childNodes[0].childNodes[0].value;
                var val=parseInt(table.childNodes[i].childNodes[1].childNodes[0].value);
                data.push( {name:nm,count:val,color:getColorCode()});
               
                
            }


            var totalCount=0;
            var radius=80;

            for(var i=0;i<data.length;++i)
            totalCount+=data[i].count;
        // alert(totalCount);
        
            ctx.arc(w/4,h/2,radius,0,2*Math.PI);
            ctx.stroke();

            var currentAngle=-0.5*Math.PI;
            var textPosition=0;
        for(var i=0;i<data.length;++i)
        {
            var sliceAngle=(data[i].count/totalCount)*2*Math.PI;
            ctx.beginPath();
            ctx.arc(w/4,h/2,radius,currentAngle,currentAngle+sliceAngle);
            currentAngle+=sliceAngle;
            

            ctx.lineTo(w/4,h/2);
            ctx.fillStyle=data[i].color;
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.fillRect(w/1.8,(h/5.5)+textPosition,70,15);
            
            ctx.beginPath();
            ctx.font=" normal 15px Arial";
            ctx.fillStyle='black';
            ctx.fillText(data[i].name,w/1.3, (h/4.2)+textPosition );

            ctx.beginPath();
            ctx.font=" normal 13px Arial";
            ctx.fillStyle='black';
            ctx.fillText(data[i].count,w/1.6, (h/4.5)+textPosition );
            textPosition+=20;

            
           
        }
       
        ctx.lineWidth=1;
    }

    function download()

            {
                ctx.lineWidth=4;
                ctx.moveTo(0,0);
                ctx.lineTo(w,0);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(w,0);
                ctx.lineTo(w,h);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(0,0);
                ctx.lineTo(0,h);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(0,h);
                ctx.lineTo(w,h);
                ctx.stroke();
                ctx.beginPath();
                

                 ctx.beginPath();
                 ctx.font=" italic bold 16px Arial";
                 ctx.fillStyle='black';
                 ctx.fillText(charttile.value,10,30);


                var link=document.createElement('a');
                link.download='Chart'+(Math.round(Math.random()*1000))+'.png';
                link.href=canvas.toDataURL();
                link.click();

                ctx.lineWidth=1;
        
            }
  
</script>
</html>
